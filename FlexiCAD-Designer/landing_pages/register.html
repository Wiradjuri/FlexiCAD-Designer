<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>FlexiCAD — Register</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico"/>

  <script src="config/config.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
  <script src="https://js.stripe.com/v3/"></script>

  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif;background:#0e0f12;color:#e9eef6}
    .wrap{max-width:420px;margin:40px auto;padding:24px;background:#16181d;border:1px solid #23262f;border-radius:16px}
    h1{margin-bottom:12px}
    .muted{color:#a9b3c2;margin-bottom:16px}
    label{display:block;margin-top:10px;margin-bottom:6px}
    input,select{width:100%;padding:10px;border-radius:10px;border:1px solid #2b2f39;background:#0f1116;color:#e9eef6}
    button{margin-top:16px;width:100%;padding:12px;border:none;border-radius:12px;background:#4f8cff;color:white;cursor:pointer}
    a{color:#cfe1ff}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Create your account</h1>
    <p class="muted">Registration creates a Supabase user. Payments are optional and can be wired later.</p>

    <form id="registerForm">
      <label>Name</label>
      <input type="text" id="name" required autocomplete="name"/>

      <label>Email</label>
      <input type="email" id="email" required autocomplete="email"/>

      <label>Password</label>
      <input type="password" id="password" required autocomplete="new-password"/>

      <label>Plan</label>
      <select id="plan"></select>
        <option value="monthly">Monthly — $10 AUD</option>
        <option value="yearly">Yearly — $50 AUD</option>
      </select>

      <button type="submit">Register</button>
    </form>

    <p class="muted" style="margin-top:14px">Have an account? <a href="login.html">Login</a></p>
    <p><a href="index.html">← Back to Home</a></p>
  </div>

  <script>
    const cfg = window.AppConfig || {};
    const hasSupabase = !!(window.supabase && window.supabase.createClient && cfg.supabase && cfg.supabase.url && cfg.supabase.anonKey &&
                          cfg.supabase.url.trim() !== '' && cfg.supabase.anonKey.trim() !== '');
    let sb = null;
    if (hasSupabase) sb = window.supabase.createClient(cfg.supabase.url, cfg.supabase.anonKey);

    document.getElementById('registerForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!sb) return alert('Auth is not configured. Please set Supabase in config.js');

      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      const plan = document.getElementById('plan').value;

      // Create user
      const { data, error } = await sb.auth.signUp({ email, password, options: { data: { name, plan } } });
      if (error) return alert(error.message);

      alert('Registration complete. Check your email for verification if required.');
      location.href = 'index.html';
    });
  </script>
</body>
</html>
