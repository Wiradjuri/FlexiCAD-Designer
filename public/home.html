<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlexiCAD Designer - Home</title>
    <link rel="stylesheet" href="css/dark-theme.css">
    <script src="config/config.js"></script>
</head>
<body>
    <nav class="nav">
        <div class="nav-container">
            <a href="/" class="nav-brand">FlexiCAD Designer</a>
            <ul class="nav-links">
                <li><a href="home.html" class="active">Home</a></li>
                <li><a href="templates.html">Templates</a></li>
                <li><a href="ai.html">AI Generator</a></li>
                <li><a href="my-designs.html">My Designs</a></li>
            </ul>
            <div class="nav-user">
                <span class="user-info" id="userInfo"></span>
                <button class="logout-btn" onclick="handleLogout()">Logout</button>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="page-header">
            <h1 class="page-title">Welcome to FlexiCAD Designer</h1>
            <p class="page-subtitle">Your AI-powered 3D design companion for creating stunning OpenSCAD models</p>
        </div>

        <div class="card-grid">
            <div class="card">
                <div class="card-title">ðŸ¤– AI Generator</div>
                <div class="card-description">
                    Describe your 3D design in plain English and let our AI generate OpenSCAD code for you. 
                    Perfect for rapid prototyping and exploring new ideas.
                </div>
                <div class="card-actions">
                    <a href="ai.html" class="btn btn-primary">Start Creating</a>
                </div>
            </div>

            <div class="card">
                <div class="card-title">ðŸ“š Template Library</div>
                <div class="card-description">
                    Browse our curated collection of OpenSCAD templates. From Arduino cases to automotive parts, 
                    find the perfect starting point for your project.
                </div>
                <div class="card-actions">
                    <a href="templates.html" class="btn btn-secondary">Browse Templates</a>
                </div>
            </div>

            <div class="card">
                <div class="card-title">ðŸ’¾ My Designs</div>
                <div class="card-description">
                    Access all your saved designs, AI-generated creations, and custom modifications. 
                    Organize and manage your 3D design portfolio.
                </div>
                <div class="card-actions">
                    <a href="my-designs.html" class="btn btn-secondary">View Designs</a>
                </div>
            </div>

            <div class="card">
                <div class="card-title">âš¡ Quick Start</div>
                <div class="card-description">
                    New to FlexiCAD? Start with our popular templates or try the AI generator with simple prompts 
                    like "design a phone case" or "create a desk organizer".
                </div>
                <div class="card-actions">
                    <a href="templates.html" class="btn btn-secondary btn-small">Templates</a>
                    <a href="ai.html" class="btn btn-primary btn-small">Try AI</a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
        // Initialize Supabase client
        const { createClient } = supabase;
        const supabaseClient = createClient(
            window.FlexiCADConfig.supabase.url,
            window.FlexiCADConfig.supabase.anonKey
        );

        // Check authentication on page load
        checkAuth();

        async function checkAuth() {
            const { data: { user } } = await supabaseClient.auth.getUser();
            
            if (!user) {
                window.location.href = 'login.html';
                return;
            }

            // Display user info
            document.getElementById('userInfo').textContent = user.email;
        }

        async function handleLogout() {
            try {
                const { error } = await supabaseClient.auth.signOut();
                if (error) throw error;
                
                window.location.href = 'login.html';
            } catch (error) {
                console.error('Error logging out:', error);
                alert('Error logging out. Please try again.');
            }
        }

        // Listen for auth state changes
        supabaseClient.auth.onAuthStateChange((event, session) => {
            if (event === 'SIGNED_OUT') {
                window.location.href = 'login.html';
            }
        });
    </script>
</body>
</html>